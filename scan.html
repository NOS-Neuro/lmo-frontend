<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Run VizAI Scan | VizAI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Page layout */
    .scan-page {
      max-width: var(--max-width, 960px);
      margin: 0 auto;
      padding: 96px 16px 72px;
    }

    .scan-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .scan-header h1 {
      font-size: clamp(1.9rem, 4vw, 2.4rem);
      margin-bottom: 8px;
    }

    .scan-header p {
      color: var(--muted, #a0a3b1);
      font-size: 0.98rem;
    }

    .scan-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 32px;
    }

    @media (max-width: 768px) {
      .scan-layout { grid-template-columns: 1fr; }
    }

    /* Card + form */
    .scan-card {
      background: var(--bg-elevated, #050611);
      border-radius: 20px;
      border: 1px solid var(--border-subtle, #262738);
      padding: 24px 20px;
    }

    .scan-card h2 { font-size: 1.2rem; margin-bottom: 8px; }

    .scan-card p {
      color: var(--muted, #a0a3b1);
      font-size: 0.92rem;
      margin-bottom: 18px;
    }

    .scan-field { margin-bottom: 16px; }

    .scan-label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--muted, #c4c5d4);
    }

    .scan-input {
      width: 100%;
      padding: 0.75rem 0.9rem;
      border-radius: 10px;
      border: 1px solid var(--border-subtle, #303244);
      background: var(--bg-soft, #070818);
      color: var(--text, #f9fafb);
      font-size: 0.96rem;
      outline: none;
    }

    .scan-input::placeholder { color: var(--muted, #7c7f96); }

    .scan-input:focus {
      border-color: var(--accent-strong, #8b5cff);
      box-shadow: 0 0 0 1px rgba(139, 92, 255, 0.5);
    }

    .scan-help {
      font-size: 0.8rem;
      color: var(--muted, #7e8195);
      margin-top: 2px;
    }

    .scan-submit { margin-top: 12px; }

    .btn-primary-full { width: 100%; justify-content: center; }

    .scan-status {
      margin-top: 10px;
      font-size: 0.85rem;
      color: var(--muted, #a0a3b1);
    }

    .hidden { display: none; }

    .results-card {
      background: var(--bg-elevated, #050611);
      border-radius: 20px;
      border: 1px solid var(--border-subtle, #262738);
      padding: 24px 20px;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 12px;
      margin-bottom: 16px;
    }

    .results-header h2 { font-size: 1.1rem; }

    .overall-score { font-size: 1.6rem; font-weight: 600; }

    .score-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    @media (max-width: 540px) { .score-grid { grid-template-columns: 1fr; } }

    .score-chip {
      background: var(--bg-soft, #070818);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 0.85rem;
    }

    .score-label { color: var(--muted, #a0a3b1); margin-bottom: 2px; }

    .score-value { font-size: 1.1rem; font-weight: 600; }

    .package-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(139, 92, 255, 0.12);
      color: var(--accent-strong, #b89cff);
      margin-bottom: 8px;
    }

    .findings-list {
      font-size: 0.9rem;
      color: var(--muted, #c0c2d8);
      margin-top: 6px;
      padding-left: 18px;
    }

    .findings-list li + li { margin-top: 4px; }

    .strategy-block {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid var(--border-subtle, #262738);
      font-size: 0.9rem;
    }

    .strategy-title { font-weight: 500; margin-bottom: 4px; }

    .strategy-text { color: var(--muted, #c0c2d8); }

    /* Checkbox row */
    .check-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--bg-soft, #070818);
      border: 1px solid var(--border-subtle, #303244);
      margin-top: 8px;
    }

    .check-row input {
      width: 16px;
      height: 16px;
      margin-top: 2px;
      accent-color: var(--accent-strong, #8b5cff);
    }

    .check-row label {
      font-size: 0.88rem;
      color: var(--muted, #c0c2d8);
      line-height: 1.25rem;
      cursor: pointer;
    }

    .mini-note {
      font-size: 0.78rem;
      color: var(--muted, #7e8195);
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <custom-navbar></custom-navbar>

  <main>
    <section class="scan-page">
      <div class="scan-header">
        <div class="pill">VizAI Scan</div>
        <h1>See how AI understands your business</h1>
        <p>
          Enter your business name, website, and email. VizAI generates a visibility report
          you can keep — and we store it so you can compare future scans as you improve.
        </p>
      </div>

      <div class="scan-layout">
        <!-- Form card -->
        <div class="scan-card">
          <h2>Run a VizAI Scan</h2>
          <p>
            You’ll get Discovery, Accuracy, and Authority scores, plus key findings and a recommended next step.
            We’ll email you a copy of the report.
          </p>

          <form id="scanForm">
            <div class="scan-field">
              <label for="businessName" class="scan-label">Business Name</label>
              <input
                id="businessName"
                type="text"
                required
                class="scan-input"
                placeholder="Your company name"
              />
            </div>

            <div class="scan-field">
              <label for="website" class="scan-label">Website URL</label>
              <input
                id="website"
                type="url"
                required
                class="scan-input"
                placeholder="https://yourbusiness.com"
              />
            </div>

            <div class="scan-field">
              <label for="contactEmail" class="scan-label">Email (send me the report)</label>
              <input
                id="contactEmail"
                type="email"
                required
                class="scan-input"
                placeholder="you@company.com"
              />
            </div>

            <div class="check-row">
              <input id="requestContact" type="checkbox" />
              <label for="requestContact">
                Please contact me to discuss improving these results.
                <div class="mini-note">If checked, the VizAI team will be notified.</div>
              </label>
            </div>

            <p class="scan-help" style="margin-top: 10px; margin-bottom: 10px;">
              This scan may take ~10–30 seconds. The report is AI-assisted and intended as a directional baseline.
            </p>

            <div class="scan-submit">
              <button type="submit" class="btn-primary btn-primary-full" id="scanSubmitButton">
                <span>Run VizAI Scan</span>
                <span class="icon">⚡</span>
              </button>
            </div>

            <div id="scanStatus" class="scan-status hidden"></div>

            <div class="mini-note">
              By running a scan you agree we may store the result for comparison over time. We don’t sell scan data.
            </div>
          </form>
        </div>

        <!-- Results card -->
        <div id="results" class="results-card hidden">
          <div class="results-header">
            <div>
              <div class="package-tag" id="scoreBandTag">
                <span>◎</span>
                <span>Score band</span>
              </div>
              <h2 id="resultsTitle">Your VizAI results</h2>
            </div>
            <div class="overall-score" id="overallScore"></div>
          </div>

          <div class="score-grid">
            <div class="score-chip">
              <div class="score-label">Discovery</div>
              <div class="score-value" id="discoveryScore">–</div>
            </div>
            <div class="score-chip">
              <div class="score-label">Accuracy</div>
              <div class="score-value" id="accuracyScore">–</div>
            </div>
            <div class="score-chip">
              <div class="score-label">Authority</div>
              <div class="score-value" id="authorityScore">–</div>
            </div>
          </div>

          <div id="packageBlock" class="strategy-block">
            <div class="strategy-title" id="packageTitle">Recommended next step</div>
            <div class="strategy-text" id="packageText"></div>
          </div>

          <div class="strategy-block">
            <div class="strategy-title">Key findings</div>
            <ul class="findings-list" id="findingsList"></ul>
          </div>
        </div>
      </div>
    </section>
  </main>

  <custom-footer></custom-footer>
  <script src="components/navbar.js"></script>
  <script src="components/footer.js"></script>

  <script>
    const API_BASE = "https://lmo-backend.onrender.com";

    const form = document.getElementById("scanForm");
    const statusEl = document.getElementById("scanStatus");
    const resultsCard = document.getElementById("results");
    const submitBtn = document.getElementById("scanSubmitButton");

    const overallScoreEl = document.getElementById("overallScore");
    const discoveryScoreEl = document.getElementById("discoveryScore");
    const accuracyScoreEl = document.getElementById("accuracyScore");
    const authorityScoreEl = document.getElementById("authorityScore");
    const findingsListEl = document.getElementById("findingsList");
    const scoreBandTagEl = document.getElementById("scoreBandTag");
    const packageTitleEl = document.getElementById("packageTitle");
    const packageTextEl = document.getElementById("packageText");

    function computePackage(overall) {
      let bandLabel, nextStepTitle, strategy;

      if (overall >= 80) {
        bandLabel = "Strong visibility (80–100)";
        nextStepTitle = "Recommended: Monitoring + drift checks";
        strategy =
          "You’re in a strong position. The next step is monitoring and small fixes as AI answers drift over time. " +
          "We can help lock in a Truth File, verify schema, and run re-audits on a schedule.";
      } else if (overall >= 40) {
        bandLabel = "Partial visibility (40–79)";
        nextStepTitle = "Recommended: Fix gaps + add structured signals";
        strategy =
          "AI likely finds you but misses key details or relies on weak sources. " +
          "Next step is improving structured data, strengthening your About/FAQ, " +
          "and seeding authoritative profiles so AI cites you correctly.";
      } else {
        bandLabel = "High-risk visibility (0–39)";
        nextStepTitle = "Recommended: Rebuild your AI presence";
        strategy =
          "AI may not recognize you, may confuse your services, or may cite competitors/directories instead. " +
          "Next step is establishing a canonical Truth File, deploying schema, and building authority sources to correct the record.";
      }

      return { bandLabel, nextStepTitle, strategy };
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const businessName = document.getElementById("businessName").value.trim();
      const website = document.getElementById("website").value.trim();
      const contactEmail = document.getElementById("contactEmail").value.trim();
      const requestContact = !!document.getElementById("requestContact").checked;

      if (!businessName || !website || !contactEmail) return;

      statusEl.textContent = "Running VizAI Scan… (10–30s)";
      statusEl.classList.remove("hidden");
      resultsCard.classList.add("hidden");
      submitBtn.disabled = true;

      try {
        const resp = await fetch(`${API_BASE}/run_scan`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            businessName,
            website,
            contactEmail,
            requestContact,
            models: [] // kept for backward compatibility
          }),
        });

        if (!resp.ok) {
          const txt = await resp.text().catch(() => "");
          throw new Error(`API error ${resp.status} ${txt}`);
        }

        const data = await resp.json();

        const d = Number(data.discovery_score ?? 0);
        const a = Number(data.accuracy_score ?? 0);
        const au = Number(data.authority_score ?? 0);

        const overall = Number.isFinite(Number(data.overall_score))
          ? Number(data.overall_score)
          : Math.round((d + a + au) / 3);

        const { bandLabel, nextStepTitle, strategy } = computePackage(overall);

        overallScoreEl.textContent = `${overall}/100`;
        discoveryScoreEl.textContent = d;
        accuracyScoreEl.textContent = a;
        authorityScoreEl.textContent = au;

        scoreBandTagEl.innerHTML = `<span>◎</span><span>${bandLabel}</span>`;
        packageTitleEl.textContent = nextStepTitle;
        packageTextEl.textContent = strategy;

        findingsListEl.innerHTML = "";
        const findings = Array.isArray(data.findings) ? data.findings : [];
        if (findings.length) {
          findings.forEach((f) => {
            const li = document.createElement("li");
            li.textContent = f;
            findingsListEl.appendChild(li);
          });
        } else {
          const li = document.createElement("li");
          li.textContent = "No detailed findings were returned for this scan.";
          findingsListEl.appendChild(li);
        }

        resultsCard.classList.remove("hidden");
        statusEl.classList.add("hidden");
        resultsCard.scrollIntoView({ behavior: "smooth", block: "start" });
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "Something went wrong running the scan. Please try again in a moment.";
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>







